<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°Šäº«æ——èˆ°çº§æŠ½å¥–ç³»ç»Ÿ</title>
    <style>
        /* ================== CSS å˜é‡ç³»ç»Ÿ (å®æ—¶è”åŠ¨æ ¸å¿ƒ) ================== */
        :root {
            /* å­—ä½“ä¸æ ‡é¢˜ */
            --font-family: "Microsoft YaHei";
            --m-title-size: 60px;
            --m-title-color: #ffffff;
            --m-title-weight: bold;
            --s-title-size: 24px;
            --s-title-color: rgba(255,255,255,0.9);

            /* èƒŒæ™¯ */
            --bg-source: url('èƒŒæ™¯.jpg');

            /* æŠ½å¥–åŒºåŸŸ */
            --box-width: 800px;
            --box-height: 300px;
            --box-border: 2px;
            --box-bg: rgba(255, 255, 255, 0.1);

            /* æŒ‰é’® */
            --btn-width: 240px;
            --btn-height: 70px;
            --btn-bg: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            --btn-border: 1px;
            
            /* å†å²è®°å½• */
            --history-display: block;
            --history-color: #fff;
        }

        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: var(--font-family), sans-serif; }

        /* ================== å‰å°è§†è§‰ ================== */
        #frontend {
            width: 100%; height: 100%;
            background: var(--bg-source) no-repeat center center;
            background-size: cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; z-index: 1;
        }

        /* æ ‡é¢˜åŒº */
        .header { text-align: center; margin-bottom: 40px; text-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        #main-title { 
            font-size: var(--m-title-size); color: var(--m-title-color); 
            font-weight: var(--m-title-weight); margin: 0; 
            letter-spacing: 2px;
        }
        #sub-title { font-size: var(--s-title-size); color: var(--s-title-color); margin-top: 10px; }

        /* æŠ½å¥–å®¹å™¨ (æ¯›ç»ç’ƒ) */
        #lottery-box {
            width: var(--box-width); height: var(--box-height);
            border: var(--box-border) solid rgba(255,255,255,0.3);
            background: var(--box-bg);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 40px; overflow: hidden;
        }

        .slots-wrapper { display: flex; justify-content: space-around; width: 100%; padding: 0 20px; }
        .slot-item {
            flex: 1; text-align: center; color: white; font-size: 3.5rem; font-weight: bold;
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* åŠ¨æ•ˆçŠ¶æ€ */
        .state-rolling {
            filter: blur(4px); opacity: 0.7; transform: scale(0.9);
            animation: shake 0.1s infinite;
        }
        .state-winner {
            color: #fff; font-style: italic;
            text-shadow: 0 0 10px #fff, 0 0 20px #ff00de, 0 0 40px #ff00de;
            animation: win-pop 0.6s cubic-bezier(0.17, 0.89, 0.32, 1.4) forwards;
        }

        @keyframes shake { 0% { transform: translate(1px, 1px) scale(0.9); } 100% { transform: translate(-1px, -1px) scale(0.9); } }
        @keyframes win-pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1.2); opacity: 1; } }

        /* æŒ‰é’® */
        #draw-btn {
            width: var(--btn-width); height: var(--btn-height);
            background: var(--btn-bg);
            border: var(--btn-border) solid rgba(255,255,255,0.5);
            border-radius: 50px; color: white; cursor: pointer;
            font-size: 1.6rem; display: flex; align-items: center; justify-content: center; gap: 10px;
            backdrop-filter: blur(5px); user-select: none;
        }
        #draw-btn:hover { background: rgba(255,255,255,0.25); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        #draw-btn:active { transform: scale(0.95); }

        /* å†å²è®°å½• */
        #history-container {
            margin-top: 30px; width: 80%; max-height: 200px; overflow-y: auto;
            display: var(--history-display); color: var(--history-color);
            text-align: center; scrollbar-width: none;
        }
        .history-row {
            background: rgba(0,0,0,0.2); padding: 10px; margin-bottom: 6px; border-radius: 8px;
            font-size: 15px; animation: slide-up 0.4s ease; border: 1px solid rgba(255,255,255,0.05);
        }
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ================== åå°æ§åˆ¶é¢æ¿ ================== */
        #backend-trigger {
            position: fixed; bottom: 20px; left: 20px; width: 45px; height: 45px;
            background: rgba(255,255,255,0.15); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer; z-index: 9999;
            backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2);
            transition: 0.3s;
        }
        #backend-trigger:hover { background: white; transform: rotate(90deg); }

        #backend-panel {
            position: fixed; bottom: 75px; left: 20px; width: 480px; max-height: 85vh;
            background: rgba(255, 255, 255, 0.98); border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4); z-index: 9998;
            display: none; flex-direction: column; padding: 20px;
            overflow-y: auto; font-size: 13px; color: #333;
        }

        .group { border-bottom: 1px dashed #ddd; padding-bottom: 15px; margin-bottom: 15px; }
        .group-title { font-weight: bold; color: #2980b9; margin-bottom: 10px; border-left: 4px solid #3498db; padding-left: 8px; display: flex; justify-content: space-between; user-select: none;}
        
        .row { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; }
        .col { flex: 1; }
        label { display: block; font-weight: bold; margin-bottom: 3px; font-size: 12px; color: #555; }
        input, select, textarea { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; }
        input[type="range"] { padding: 0; margin-top: 5px; }
        .hint { font-size: 11px; color: #888; margin-top: -3px; margin-bottom: 5px; line-height: 1.3; }

        .btn-action { width: 100%; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; margin-top: 5px; }
        .btn-green { background: #27ae60; }
        .btn-red { background: #c0392b; }

        /* éšè—é¡µé¢ (æš—ç®±) */
        #secret-layer {
            display: none; background: #fff0f0; border: 2px dashed #e74c3c; padding: 10px; border-radius: 8px; margin-top: 10px;
        }
        .cheat-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .cheat-list { max-height: 60px; overflow-y: auto; font-size: 11px; color: #c0392b; margin-top: 5px; }

    </style>
</head>
<body>

<div id="frontend">
    <div class="header">
        <h1 id="main-title">å¹¸è¿å¤§æŠ½å¥–</h1>
        <div id="sub-title">GOOD LUCK TO YOU</div>
    </div>

    <div id="lottery-box">
        <div class="slots-wrapper" id="slots-area">
            <div class="slot-item">?</div>
        </div>
    </div>

    <button id="draw-btn" onclick="handleLottery()">
        <span id="btn-icon">ğŸ</span>
        <span id="btn-text">å¼€å§‹æŠ½å¥–</span>
    </button>

    <div id="history-container"></div>
</div>

<div id="backend-trigger" onclick="toggleBackend()">âš™ï¸</div>

<div id="backend-panel">
    
    <div class="group">
        <div class="group-title">1. æ ‡é¢˜ä¸èƒŒæ™¯</div>
        <div class="row">
            <div class="col"><label>ä¸»æ ‡é¢˜</label><input type="text" id="in-m-title" value="å¹¸è¿å¤§æŠ½å¥–" oninput="uiSync()"></div>
            <div class="col"><label>å‰¯æ ‡é¢˜</label><input type="text" id="in-s-title" value="GOOD LUCK TO YOU" oninput="uiSync()"></div>
        </div>
        <div class="row">
            <div class="col"><label>å¤§å°</label><input type="number" id="in-m-size" value="60" oninput="uiSync()"></div>
            <div class="col"><label>é¢œè‰²</label><input type="color" id="in-m-color" value="#ffffff" oninput="uiSync()"></div>
            <div class="col">
                <label>å­—ä½“</label>
                <select id="in-font" onchange="uiSync()">
                    <option value="Microsoft YaHei">å¾®è½¯é›…é»‘</option>
                    <option value="SimHei">é»‘ä½“</option>
                    <option value="KaiTi">æ¥·ä½“</option>
                    <option value="Arial">Arial</option>
                </select>
            </div>
        </div>
        <label>èƒŒæ™¯è®¾ç½® (å›¾ç‰‡URL æˆ– æ¸å˜ä»£ç )</label>
        <input type="text" id="in-bg" value="url('èƒŒæ™¯.jpg')" oninput="uiSync()">
        <div class="hint">ç¤ºä¾‹ï¼šurl('bg.jpg') æˆ– linear-gradient(45deg, #f00, #00f)</div>
    </div>

    <div class="group">
        <div class="group-title">2. éŸ³ä¹æ§åˆ¶</div>
        <div class="row">
            <div class="col"><label>æ»šåŠ¨éŸ³ä¹ (URL)</label><input type="text" id="in-mu1" value="éŸ³ä¹1.mp3"></div>
            <div class="col"><label>éŸ³é‡</label><input type="range" id="in-vol1" min="0" max="1" step="0.1" value="0.6"></div>
        </div>
        <div class="row">
            <div class="col"><label>ä¸­å¥–éŸ³ä¹ (URL)</label><input type="text" id="in-mu2" value="éŸ³ä¹2.mp3"></div>
            <div class="col"><label>éŸ³é‡</label><input type="range" id="in-vol2" min="0" max="1" step="0.1" value="0.8"></div>
        </div>
        <div class="hint">ä¸­å¥–éŸ³ä¹æ’­æ”¾3ç§’åä¼šè‡ªåŠ¨é€æ¸æ·¡å‡ºã€‚</div>
    </div>

    <div class="group">
        <div class="group-title">3. åŒºåŸŸä¸æŒ‰é’®æ ·å¼</div>
        <div class="row">
            <div class="col"><label>æ¡†å®½</label><input type="number" id="in-box-w" value="800" oninput="uiSync()"></div>
            <div class="col"><label>æ¡†é«˜</label><input type="number" id="in-box-h" value="300" oninput="uiSync()"></div>
            <div class="col"><label>æ¡†èƒŒæ™¯</label>
                <select id="in-box-bg" onchange="uiSync()">
                    <option value="rgba(255,255,255,0.1)">é€æ˜ç£¨ç ‚</option>
                    <option value="rgba(0,0,0,0.4)">åŠé€é»‘</option>
                    <option value="linear-gradient(to bottom, rgba(255,255,255,0.2), transparent)">æ¸å˜é€</option>
                </select>
            </div>
        </div>
        <div class="row">
            <div class="col"><label>æŒ‰é’®å®½</label><input type="number" id="in-btn-w" value="240" oninput="uiSync()"></div>
            <div class="col"><label>å›¾æ ‡</label>
                <select id="in-btn-icon" onchange="uiSync()">
                    <option value="ğŸ">ğŸ</option><option value="ğŸ”¥">ğŸ”¥</option><option value="âš¡">âš¡</option>
                </select>
            </div>
            <div class="col"><label>è§’æ ‡å›¾æ ‡</label>
                <select id="in-badge" onchange="uiSync()">
                    <option value="âš™ï¸">âš™ï¸</option><option value="ğŸ”§">ğŸ”§</option><option value="ğŸ”’">ğŸ”’</option>
                </select>
            </div>
        </div>
    </div>

    <div class="group">
        <div class="group-title" id="secret-trigger" onclick="tryUnlockSecret()" style="cursor: pointer;">4. åå•ä¸ç³»ç»Ÿè®¾ç½® (ç‚¹æ­¤3æ¬¡)</div>
        
        <label>åŒæ—¶æŠ½å–äººæ•°</label>
        <input type="number" id="in-count" value="1" min="1" max="10" oninput="initSlots()">
        
        <label>å¯¼å…¥äººå‘˜åå• (ä¸­æ–‡, é€—å·åˆ†éš”, Max 500)</label>
        <textarea id="in-names" rows="4">èµµä¸€,é’±äºŒ,å­™ä¸‰,æå››,å‘¨äº”,å´å…­,éƒ‘ä¸ƒ,ç‹å…«,å†¯ä¹,é™ˆå,è¤šåä¸€,å«åäºŒ,è’‹åä¸‰,æ²ˆåå››,éŸ©åäº”,æ¨åå…­</textarea>
        
        <label>ä¸­å¥–åå•æ˜¾ç¤º</label>
        <select id="in-list-show" onchange="uiSync()">
            <option value="block">æ˜¾ç¤º</option><option value="none">éšè—</option>
        </select>

        <div class="row">
            <button class="btn-action btn-green" onclick="saveData()">ä¿å­˜é…ç½®</button>
            <button class="btn-action btn-red" onclick="resetAll()">é‡ç½®è®°å½•</button>
        </div>

        <div id="secret-layer">
            <h4>ğŸ¤« å‘½è¿å¹²é¢„ç³»ç»Ÿ (éšè—åŠŸèƒ½)</h4>
            <div class="hint">è®¾ç½®ç‰¹å®šè½®æ¬¡çš„å¿…ä¸­åå•ã€‚æ³¨æ„ï¼šå¿…ä¸­äººæ•°ä¸è¦è¶…è¿‡è¯¥è½®çš„æŠ½å–äººæ•°ã€‚</div>
            <div class="cheat-row">
                <input type="number" id="cheat-round" placeholder="è½®æ¬¡(å¦‚1)" style="width: 60px;">
                <input type="text" id="cheat-names" placeholder="å¿…ä¸­äººå(é€—å·éš”å¼€)">
                <button style="width: 60px; background:#e74c3c; color:white; border:none; border-radius:4px;" onclick="addCheat()">æ·»åŠ </button>
            </div>
            <div class="cheat-list" id="cheat-display">æš‚æ— å¹²é¢„é…ç½®</div>
        </div>
    </div>
    
    <div style="font-size:11px; color:#888; text-align:center;">
        å½“å‰çŠ¶æ€ï¼šç¬¬ <span id="status-round">1</span> è½® | å‰©ä½™ <span id="status-count">0</span> äºº
    </div>
</div>

<audio id="bgm-roll" loop></audio>
<audio id="bgm-win"></audio>

<script>
    // --- æ ¸å¿ƒçŠ¶æ€ ---
    let fullList = [];
    let availableList = [];
    let winners = [];
    let isRolling = false;
    let rollTimer = null;
    let currentRound = 1;
    let cheatConfig = {}; // æ ¼å¼: { 1: ["å¼ ä¸‰", "æå››"], 2: ["ç‹äº”"] }
    let secretClickCount = 0;

    // --- åˆå§‹åŒ– ---
    window.onload = () => {
        saveData();
        uiSync();
    };

    function toggleBackend() {
        const p = document.getElementById('backend-panel');
        p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
    }

    // --- æ ·å¼åŒæ­¥ (CSSå˜é‡) ---
    function uiSync() {
        const r = document.documentElement.style;
        const val = (id) => document.getElementById(id).value;
        
        // æ ‡é¢˜
        document.getElementById('main-title').innerText = val('in-m-title');
        document.getElementById('sub-title').innerText = val('in-s-title');
        r.setProperty('--m-title-size', val('in-m-size') + 'px');
        r.setProperty('--m-title-color', val('in-m-color'));
        r.setProperty('--font-family', val('in-font'));
        
        // èƒŒæ™¯
        let bg = val('in-bg');
        if(!bg.includes('url') && !bg.includes('gradient')) bg = `url('${bg}')`;
        r.setProperty('--bg-source', bg);

        // ç›’å­
        r.setProperty('--box-width', val('in-box-w') + 'px');
        r.setProperty('--box-height', val('in-box-h') + 'px');
        r.setProperty('--box-bg', val('in-box-bg'));

        // æŒ‰é’®
        r.setProperty('--btn-width', val('in-btn-w') + 'px');
        document.getElementById('btn-icon').innerText = val('in-btn-icon');
        document.getElementById('backend-trigger').innerText = val('in-badge');

        // åˆ—è¡¨
        r.setProperty('--history-display', val('in-list-show'));
    }

    function initSlots() {
        if(isRolling) return;
        const count = parseInt(document.getElementById('in-count').value);
        const area = document.getElementById('slots-area');
        area.innerHTML = '';
        for(let i=0; i<count; i++) {
            area.innerHTML += `<div class="slot-item">?</div>`;
        }
    }

    // --- æ•°æ®é€»è¾‘ ---
    function saveData() {
        const raw = document.getElementById('in-names').value;
        fullList = raw.split(/[,ï¼Œ\n]/).map(s => s.trim()).filter(s => s);
        availableList = [...new Set(fullList)]; // å»é‡
        winners = [];
        currentRound = 1;
        document.getElementById('history-container').innerHTML = '';
        document.getElementById('status-round').innerText = 1;
        updateStatus();
        initSlots();
    }

    function updateStatus() {
        document.getElementById('status-count').innerText = availableList.length;
    }

    function resetAll() {
        if(confirm("ç¡®å®šé‡ç½®æ‰€æœ‰è®°å½•ï¼Ÿæ‰€æœ‰äººéƒ½å¯å†æ¬¡ä¸­å¥–ã€‚")) {
            saveData();
            alert("ç³»ç»Ÿå·²é‡ç½®ï¼Œä¸­å¥–è€…ä¸ä¼šå†æ¬¡ä¸­å¥–çš„é™åˆ¶å·²åˆ·æ–°ã€‚");
        }
    }

    // --- éšè—åŠŸèƒ½é€»è¾‘ ---
    function tryUnlockSecret() {
        secretClickCount++;
        if(secretClickCount === 3) {
            document.getElementById('secret-layer').style.display = 'block';
        }
    }

    function addCheat() {
        const r = parseInt(document.getElementById('cheat-round').value);
        const names = document.getElementById('cheat-names').value.split(/[,ï¼Œ]/).map(s=>s.trim()).filter(s=>s);
        
        if(!r || names.length === 0) return;
        
        cheatConfig[r] = names;
        renderCheatList();
        document.getElementById('cheat-names').value = '';
    }

    function renderCheatList() {
        const div = document.getElementById('cheat-display');
        let html = '';
        for(let r in cheatConfig) {
            html += `<div>ç¬¬ ${r} è½®å¿…ä¸­: [${cheatConfig[r].join(', ')}]</div>`;
        }
        div.innerHTML = html || 'æš‚æ— é…ç½®';
    }

    // --- æ ¸å¿ƒæŠ½å¥– ---
    function handleLottery() {
        const btnText = document.getElementById('btn-text');
        const count = parseInt(document.getElementById('in-count').value);
        const audioRoll = document.getElementById('bgm-roll');
        const audioWin = document.getElementById('bgm-win');

        if(!isRolling) {
            // == å¼€å§‹ ==
            if(availableList.length < count) {
                alert("å‰©ä½™äººå‘˜ä¸è¶³ï¼è¯·é‡ç½®ç³»ç»Ÿã€‚");
                return;
            }

            isRolling = true;
            btnText.innerText = "åœæ­¢æŠ½å¥–";
            
            // æ’­æ”¾æ»šåŠ¨éŸ³ä¹
            audioRoll.src = document.getElementById('in-mu1').value;
            audioRoll.volume = document.getElementById('in-vol1').value;
            audioRoll.play();

            const slots = document.querySelectorAll('.slot-item');
            rollTimer = setInterval(() => {
                slots.forEach(slot => {
                    const r = Math.floor(Math.random() * availableList.length);
                    slot.innerText = availableList[r];
                    slot.className = 'slot-item state-rolling';
                });
            }, 80);

        } else {
            // == åœæ­¢ ==
            isRolling = false;
            btnText.innerText = "å¼€å§‹æŠ½å¥–";
            clearInterval(rollTimer);
            
            audioRoll.pause();
            audioRoll.currentTime = 0;

            // æ’­æ”¾ä¸­å¥–éŸ³ä¹ + æ·¡å‡ºé€»è¾‘
            audioWin.src = document.getElementById('in-mu2').value;
            audioWin.volume = document.getElementById('in-vol2').value;
            audioWin.play();
            
            // 3ç§’åæ·¡å‡º
            setTimeout(() => {
                let vol = audioWin.volume;
                const fade = setInterval(() => {
                    if(vol > 0.05) {
                        vol -= 0.05;
                        audioWin.volume = vol;
                    } else {
                        audioWin.pause();
                        clearInterval(fade);
                    }
                }, 100);
            }, 2500);

            // è®¡ç®—è·å¥–è€…
            let roundWinners = [];
            
            // 1. å¤„ç†æš—ç®±æ“ä½œ
            if(cheatConfig[currentRound]) {
                const cheats = cheatConfig[currentRound];
                cheats.forEach(name => {
                    // åªæœ‰å½“è¯¥äººåœ¨availableListä¸­æ‰æœ‰æ•ˆ
                    const idx = availableList.indexOf(name);
                    if(idx !== -1 && roundWinners.length < count) {
                        roundWinners.push(name);
                        availableList.splice(idx, 1);
                    }
                });
            }

            // 2. è¡¥é½éšæœºåé¢
            while(roundWinners.length < count && availableList.length > 0) {
                const idx = Math.floor(Math.random() * availableList.length);
                roundWinners.push(availableList[idx]);
                availableList.splice(idx, 1);
            }

            winners = winners.concat(roundWinners);

            // æ›´æ–°UI
            const slots = document.querySelectorAll('.slot-item');
            slots.forEach((slot, i) => {
                if(roundWinners[i]) {
                    slot.innerText = roundWinners[i];
                    slot.className = 'slot-item state-winner';
                } else {
                    slot.innerText = "";
                }
            });

            // è®°å½•å†å²
            const historyDiv = document.getElementById('history-container');
            const row = document.createElement('div');
            row.className = 'history-row';
            row.innerHTML = `<strong>ç¬¬ ${currentRound} è½®ï¼š</strong> ${roundWinners.join('ã€')}`;
            historyDiv.appendChild(row); // ä¾æ¬¡å‘ä¸‹

            currentRound++;
            document.getElementById('status-round').innerText = currentRound;
            updateStatus();
        }
    }
</script>
</body>
</html>
